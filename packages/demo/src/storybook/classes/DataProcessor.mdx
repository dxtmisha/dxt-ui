import {Meta} from '@storybook/addon-docs/blocks'

<Meta title='@dxtmisha/demo/classes/DataProcessor - Управление, фильтрация и трансформация данных'/>

# Class DataProcessor

Универсальный класс для эффективного управления, фильтрации и преобразования массивов данных. Поддерживает асинхронную загрузку внешних данных и предоставляет инструменты для пагинации, поиска и удаления дубликатов.

## Ключевые возможности

- **Асинхронная загрузка** — встроенная поддержка загрузки данных из внешних источников с автоматическим отслеживанием состояния выполнения.
- **Гибкая трансформация** — методы для массового обновления, фильтрации и преобразования элементов массива.
- **Встроенная пагинация** — простой механизм получения срезов данных для постраничного отображения.
- **Удаление дубликатов** — возможность очистки данных от повторов на основе значений или пользовательских ключей.
- **Контроль состояния** — предоставление статистики о количестве элементов и текущих процессах обработки.

## Методы класса

### `constructor`

Инициализирует экземпляр класса начальным набором данных.

**Параметры:**
- `initialData: T[]` — начальный массив элементов (по умолчанию пустой).

```javascript
const processor = new DataProcessor([{ id: 1, name: 'Item 1' }]);
```

### `loadData`

Асинхронно загружает данные из предоставленного источника и добавляет их к существующим в хранилище.

**Параметры:**
- `source: () => Promise<T[]>` — функция-загрузчик, возвращающая Promise с массивом данных.

**Возвращает:**
`Promise<void>`

```javascript
await processor.loadData(async () => {
  const response = await fetch('/api/data');
  return response.json();
});
```

### `processData`

Преобразует каждый элемент в массиве с помощью функции-процессора.

**Параметры:**
- `processor: (item: T) => T` — функция, принимающая элемент и возвращающая его измененную версию.

```javascript
processor.processData(item => ({ ...item, processed: true }));
```

### `filterData`

Удаляет элементы из массива, которые не соответствуют заданному условию.

**Параметры:**
- `predicate: (item: T) => boolean` — функция для проверки каждого элемента.

```javascript
processor.filterData(item => item.isActive === true);
```

### `sortData`

Сортирует текущие данные на основе предоставленной функции сравнения.

**Параметры:**
- `comparator: (a: T, b: T) => number` — функция, определяющая порядок сортировки.

```javascript
processor.sortData((a, b) => a.id - b.id);
```

### `findItem`

Находит первый элемент, соответствующий заданному условию.

**Параметры:**
- `predicate: (item: T) => boolean` — функция-предикат для поиска.

**Возвращает:**
`T | undefined` — найденный элемент или undefined.

```javascript
const item = processor.findItem(item => item.id === 5);
```

### `getPage`

Возвращает определенный срез данных для реализации пагинации.

**Параметры:**
- `page: number` — номер страницы (начиная с 1).
- `size: number` — размер страницы (количество элементов).

**Возвращает:**
`T[]` — массив элементов указанной страницы.

```javascript
const items = processor.getPage(1, 10); // Первая страница, 10 элементов
```

### `exists`

Проверяет, существует ли в коллекции хотя бы один элемент, удовлетворяющий условию.

**Параметры:**
- `predicate: (item: T) => boolean` — функция-предикат для проверки.

**Возвращает:**
`boolean` — true, если хотя бы один элемент найден.

```javascript
const hasAdmin = processor.exists(user => user.role === 'admin');
```

### `update`

Обновляет элементы, соответствующие заданному условию, и возвращает количество затронутых записей.

**Параметры:**
- `predicate: (item: T) => boolean` — функция для выбора элементов.
- `updater: (item: T) => T` — функция, возвращающая обновленный элемент.

**Возвращает:**
`number` — количество обновленных элементов.

```javascript
const updatedCount = processor.update(
  item => item.status === 'old',
  item => ({ ...item, status: 'new' })
);
```

### `distinct`

Удаляет дубликаты из внутреннего хранилища данных.

**Параметры:**
- `keySelector?: (item: T) => any` — опциональная функция для определения уникальности (например, по id).

```javascript
// По значению целиком
processor.distinct();

// По конкретному полю
processor.distinct(item => item.id);
```

### `exportData`

Возвращает поверхностную копию текущего набора данных.

**Возвращает:**
`T[]` — массив с текущими данными.

```javascript
const currentData = processor.exportData();
```

### `clearData`

Полностью очищает внутреннее хранилище данных.

```javascript
processor.clearData();
```

### `getStats`

Возвращает объект с текущей статистикой состояния хранилища.

**Возвращает:**
`{ count: number, processing: boolean }` — объект с количеством элементов и флагом активности процесса загрузки.

```javascript
const { count, processing } = processor.getStats();
console.log(`Элементов: ${count}, Загрузка: ${processing}`);
```

**Date: 2026-01-06T16:23:17+07:00.**
