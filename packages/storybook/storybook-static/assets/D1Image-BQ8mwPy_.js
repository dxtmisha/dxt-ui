import{N as x,V as c,c as n,E as p,_ as B,a0 as v,a1 as b,r as w,a2 as j,B as $,T as S,n as d,G as A,w as F,x as H,k as W,h as g,f as C,m as M,g as P,j as _,l as D,u as O,o as R}from"./iframe-CpPdPYqc.js";const E=1280;class y{static isImage(t){return!!t.type.match(/^image\//)}static createImage(t){return new Promise(e=>{if(t){const i=new Image;i.onerror=()=>e(void 0),i.onload=()=>{e({image:i,src:this.getSRC(i,t),width:i.naturalWidth,height:i.naturalHeight})},(async()=>i.src=t instanceof File?await this.getFileResult(t):t)()}else e(void 0)})}static async getPath(t){return this.createImage(t).then(e=>e?.src??"")}static getFileResult(t){return new Promise(e=>{this.isImage(t)?this.getFileReader(t).then(i=>e(i)):e("")})}static getFileReader(t){return new Promise(e=>{const i=new FileReader;i.onload=()=>e(typeof i.result=="string"?i.result:""),i.readAsDataURL(t)})}static getSRC(t,e,i=E){if(x()&&(e instanceof File||e===void 0)&&(t.naturalHeight>i||t.naturalWidth>i)){const r=t.naturalWidth>=t.naturalHeight,o=document.createElement("canvas")?.getContext("2d");return o?(o.canvas.width=r?i:t.naturalWidth/t.naturalHeight*i,o.canvas.height=r?t.naturalHeight/t.naturalWidth*i:i,o.drawImage(t,0,0,o.canvas.width,o.canvas.height),o.canvas.toDataURL()):""}else return t.src}}const m="#toolbar=0&scrollbar=1";class k{static isPdf(t){return c(t)?!!t.match(/\.pdf$/i):!!t.type.match(/\/pdf$/i)}static async get(t){return c(t)?`${t}${m}`:this.isPdf(t)?`${await y.getFileReader(t)}${m}`:""}}var a=(s=>(s.pdf="pdf",s.file="file",s.image="image",s.flag="flag",s.color="color",s.public="public",s.filled="filled",s.outlined="outlined",s.round="round",s.sharp="sharp",s.twoTone="two-tone",s.material="material",s.icon="icon",s))(a||{});class G{constructor(t){this.props=t}item=n(()=>{const t=this.props.value;if(t instanceof File||p(t)){if(k.isPdf(t))return a.pdf;if(t instanceof File)return a.file;if(t.match(/\//))return a.image;if(t.match(B))return a.icon;if(t.match(/^#/))return a.color;if(t.match(/^@/))return a.public;if(t.match(/^\$/))return a.material;if(t.match(/^flag-[a-z]{2}$/))return a.flag;const e=t.match(/^(outlined|round|sharp|material)-/);return e?e[1]:v.is(t)?a.public:a.outlined}})}const N={adaptiveGroup:"basic"};class q{constructor(t,e){this.props=t,this.type=e,b(async()=>{this.image.value=await this.init()})}image=w();is(){return this.image.value!==void 0}isLink(){return this.is()&&typeof this.image.value=="string"}isImage(){return this.is()&&typeof this.image.value!="string"}async init(){const t=this.props.value;if(t)switch(this.type.item.value){case a.pdf:return await k.get(t);case a.image:case a.file:try{return await y.createImage(t)}catch{console.error("ImageData.initImage: ",t)}break;case a.public:case a.icon:case a.flag:if(c(t))return await v.get(t,this.props.url);break}}}class L{constructor(t){this.props=t}coordinator=n(()=>{if(this.is()){const t=this.props.coordinator;switch(t.length){case 1:return[t[0]??0,t[0]??0,t[0]??0,t[0]??0];case 2:return[t[0]??0,t[1]??0,t[0]??0,t[1]??0];case 3:return[t[0]??0,t[1]??0,t[2]??0,t[1]??0];case 4:return t}}return[0,0,0,0]});size=n(()=>{const t=this.coordinator.value;return{width:100-t[1]-t[3],height:100-t[2]-t[0]}});is(){const t=this.props.coordinator;return j(t)&&t.length>0&&t.length<5}getSize(){const t=this.size.value;return{width:`${100/t.width*100}%`,height:`${100/t.height*100}%`}}}class U{constructor(t,e){this.props=t,this.coordinator=e}x=n(()=>this.coordinator.is()?`${this.coordinator.coordinator.value[3]+this.coordinator.size.value.width/2}%`:this.props.x?.toString()||"center");y=n(()=>this.coordinator.is()?`${this.coordinator.coordinator.value[0]+this.coordinator.size.value.height/2}%`:this.props.y?.toString()||"center")}class X{constructor(t){this.name=t}factorMax=1;size={width:0,height:0};offset={width:7680,height:7680};is(t){return this.name===t}isSize(){return!!(this.size.width||this.size.width)}getWidth(){return this.size.width}getHeight(){return this.size.height}getOffsetWidth(){return this.offset.width}getOffsetHeight(){return this.offset.height}getFactorMax(){return this.factorMax}makeWidth(t){return t>this.size.width&&(this.size.width=t),this}makeHeight(t){return t>this.size.height&&(this.size.height=t),this}makeOffsetWidth(t){return t<this.offset.width&&(this.offset.width=t),this}makeOffsetHeight(t){return t<this.offset.height&&(this.offset.height=t),this}makeFactorMax(t){return t<this.factorMax&&(this.factorMax=t),this}reset(){return this.factorMax=1,this.size={width:0,height:0},this.offset={width:7680,height:7680},this}}class h{static items=[];static isSize(){return this.items.find(t=>t.isSize())!==void 0}static get(t){return this.find(t)||this.init(t)}static reset(){this.items.forEach(t=>t.reset())}static find(t){return this.items.find(e=>e.is(t))}static init(t){const e=new X(t);return this.items.push(e),e}}class u{static objects=[];static objectsAdaptive=[];static cache=[];static event;static time;static is(t){return this.objects.findIndex(e=>e===t)!==-1}static add(t){this.is(t)||(this.objects.push(t),this.make())}static remove(t){const e=this.objects.findIndex(i=>i===t);e!==-1&&(this.objects.splice(e,1),this.cache=[]),this.make()}static reset(){this.cache=[],this.start()}static make(){this.event&&this.objects.length<1?(this.event.stop(),this.event=void 0):this.objects.length>0&&(this.event||(this.event=new $(window,["scroll-sync"],()=>this.start()).start()),this.time||(this.time=!0,requestAnimationFrame(()=>{this.time=!1,this.start()})))}static getItemIdByVisible(){return S(this.objectsAdaptive,t=>t.getId())}static start(){if(this.isAdaptive()){this.makeAdaptive();const t=this.getItemIdByVisible();this.isCache(t)&&(this.cache=t,this.makeSize(),this.makePercent(),this.makeFactorMax())}else this.event?.stop()}static makeAdaptive(){this.objectsAdaptive=[],this.objects.forEach(t=>{t.make(),t.isBeyond()&&this.objectsAdaptive.push(t)})}static makeSize(){h.reset(),this.objectsAdaptive.forEach(t=>{const e=t.element.value;e&&h.get(t.group.value).makeWidth(t.width.value).makeHeight(t.height.value).makeOffsetWidth(e.offsetWidth).makeOffsetHeight(e.offsetHeight)})}static makePercent(){h.isSize()&&this.objectsAdaptive.forEach(t=>{const e=t.element.value,i=h.get(t.group.value);if(e){const r=i.getWidth(),o=i.getHeight();t.setPercent(t.width.value*(r?1/r:0)*(i.getOffsetWidth()/e.offsetWidth),t.height.value*(o?1/o:0)*(i.getOffsetHeight()/e.offsetHeight))}})}static makeFactorMax(){h.isSize()&&this.objectsAdaptive.forEach(t=>{h.get(t.group.value).makeFactorMax(t.factor.value)})}static isAdaptive(){return!!this.objects.find(t=>t.is())}static isCache(t){return this.cache.join("|")!==t.join("|")}}const Y="main",f=512;class Z{constructor(t,e,i){this.props=t,this.data=e,this.element=i,b(()=>{this.is()?u.add(this):u.remove(this)})}percent=w({width:0,height:0});beyond=!1;visible=!1;active=n(()=>!!(this.props.adaptive&&(this.width.value||this.height.value))&&this.data.isImage());group=n(()=>this.props.adaptiveGroup??Y);width=n(()=>d(this.props.objectWidth??0));height=n(()=>d(this.props?.objectHeight??0));type=n(()=>{if(this.width.value&&this.percent.value.width>0)return"x";if(this.height.value&&this.percent.value.height>0)return"y"});size=n(()=>{if(this.element.value&&this.data.isImage()){const t=this.data.image.value;switch(this.type.value){case"x":return t.height*(this.element.value.offsetWidth*this.percent.value.width/t.width);case"y":return t.width*(this.element.value.offsetHeight*this.percent.value.height/t.height)}}return 0});factor=n(()=>{const t=this.element.value;if(t){const e=this.size.value;if(this.type.value==="x"&&e>t.offsetHeight)return t.offsetHeight/e;if(this.type.value==="y"&&e>t.offsetWidth)return t.offsetWidth/e}return 1});is(){return this.active.value&&!!this.element.value?.closest("body")}isGroup(t){return this.group.value===t}isBeyond(){return this.beyond}isVisible(){return this.visible}getId(){return A(this.element.value)}getBackgroundSize(){const t=h.get(this.group.value).getFactorMax();switch(this.type.value){case"x":return`${100*this.percent.value.width*t}% auto`;case"y":return`auto ${100*this.percent.value.height*t}%`}return null}setPercent(t,e){return(this.percent.value.width!==t||this.percent.value.height!==e)&&(this.percent.value={width:t,height:e}),this}remove(){this.active.value&&u.remove(this)}make(){if(this.beyond=!1,this.visible=!1,this.element.value&&this.is())if(this.props.adaptiveAlways)this.beyond=!0,this.visible=!0;else{const t=this.element.value.getBoundingClientRect();this.beyond=!(t.bottom<0-f||t.top>window.innerHeight+f),this.visible=!(t.bottom<0||t.top>window.innerHeight)}return this}}class J{constructor(t,e,i,r){this.props=t,this.data=e,this.coordinator=i,this.adaptive=r}image=n(()=>{const t=this.data.image.value;switch(typeof t){case"string":return`url("${t}")`;case"object":return`url("${t.src}")`;default:return null}});size=n(()=>{if(this.coordinator.is())return this.getSizeByCoordinator();if(this.adaptive.is()){const t=this.adaptive.getBackgroundSize();if(t)return t}return this.getSizeForItem()});isImage(){return!!this.image.value}getSize(t,e){const i=this.data.image.value;return typeof i=="object"?i.height<i.width?`auto ${e}`:`${t} auto`:null}getSizeByCoordinator(){const{width:t,height:e}=this.coordinator.getSize();return this.getSize(t,e)}getSizeForItem(){const t=this.props.size;return p(t)?t.toString().match(/%$/)?this.getSize(t,t):t.toString():null}}let K=class{constructor(t,e,i,r){this.props=t,this.element=e,this.className=i,this.emits=r,this.type=new G(t),this.data=new q(t,this.type),this.coordinator=new L(t),this.position=new U(t,this.coordinator),this.adaptiveItem=new Z(t,this.data,e),this.background=new J(t,this.data,this.coordinator,this.adaptiveItem),r&&F(this.data.image,o=>{r("load",{type:this.type.item.value,image:o})}),H(()=>this.adaptiveItem.remove())}type;data;coordinator;position;adaptiveItem;background;text=n(()=>{const t=this.type.item.value;if(t===a.pdf){const i=this.data.image.value;if(c(i))return i}const e=this.props.value;if(t&&c(e)&&["filled","outlined","round","sharp","two-tone","material"].indexOf(t)!==-1)return e.replace(/^(filled|outlined|round|sharp|two-tone)-/,"")});classes=n(()=>{const t=this.type.item.value,e={[`${this.className}--type--${t}`]:t!==void 0,[`${this.className}--background`]:this.background.isImage(),notranslate:!0};switch(t){case"outlined":e["material-symbols-outlined"]=!0;break;case"round":e["material-symbols-rounded"]=!0;break;case"sharp":e["material-symbols-sharp"]=!0;break;case"material":e["material-icons"]=!0;break}return e});styles=n(()=>{const t=this.props.value;if(t)switch(this.type.item.value){case a.file:case a.image:return{"background-image":this.background.image.value,"background-size":this.background.size.value,"background-position-x":this.position.x.value,"background-position-y":this.position.y.value};case a.icon:return{"background-image":this.background.image.value};case a.flag:return{"background-image":this.background.image.value,"background-size":"contain"};case a.public:return{"mask-image":this.background.image.value};case a.color:if(c(t))return{"background-color":t}}return{}})};class Q extends W{item;constructor(t,e,i){super(t,e,i),this.item=new K(this.props,this.element,this.getName(),this.emits),this.init()}initExpose(){return{type:this.item.type.item,data:this.item.data.image}}initClasses(){return{main:this.item.classes.value}}initStyles(){return this.item.styles.value}initRender(){return g("span",{...this.getAttrs(),ref:this.element,class:this.classes?.value.main,style:this.styles?.value,translate:"no"},this.renderValue())}renderValue=()=>this.item.type.item.value===a.pdf?[g("object",{data:this.item.data.image.value})]:this.item.text.value}const V={size:["auto","contain","cover"]},T={...N},tt=C({name:"D1Image",__name:"D1Image",props:M({value:{},url:{},adaptiveGroup:{},adaptiveAlways:{type:Boolean},objectWidth:{},objectHeight:{},coordinator:{},x:{},y:{},turn:{type:Boolean},disabled:{type:Boolean},hide:{type:Boolean},adaptive:{type:Boolean},size:{}},T),emits:["load"],setup(s,{expose:t,emit:e}){const i=e,r=s,o=n(()=>({main:{"d1-image":!0,"d1-image--turn":r.turn,"d1-image--disabled":r.disabled,"d1-image--hide":r.hide,"d1-image--adaptive":r.adaptive,[`d1-image--size--${r.size}`]:P(V.size,r.size)}})),z=n(()=>({})),l=new Q("d1.image",r,{emits:i,classes:o,styles:z}),I=l.render();return t(l.expose()),(et,it)=>(R(),_(D(O(I))))}});tt.__docgenInfo={name:"D1Image",exportName:"default",displayName:"D1Image",description:"",tags:{},props:[{name:"size",required:!1,type:{name:"union",elements:[{name:'"auto"'},{name:'"contain"'},{name:'"cover"'}]}},{name:"adaptive",required:!1,type:{name:"boolean"}},{name:"hide",required:!1,type:{name:"boolean"}},{name:"disabled",required:!1,type:{name:"boolean"}},{name:"turn",required:!1,type:{name:"boolean"}}],sourceFiles:["/Volumes/T7/Git/dxt-ui/packages/d1/src/components/Ui/Image/D1Image.vue"]};export{tt as _,T as d};
