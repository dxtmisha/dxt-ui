import { PropertiesFile } from '../Properties/PropertiesFile'
import { LibraryItems } from './LibraryItems'
import { LibraryAiWikiItem } from './LibraryAiWikiItem'

import { UI_DIRS_COMPONENTS } from '../../config'

export class LibraryAiWiki {
  constructor(
    protected readonly items: LibraryItems
  ) {
  }

  make(): void {
    this.makeList()
    this.makeComponent()
  }

  protected getFileList(): string {
    return 'ai-list'
  }

  protected getList(): LibraryAiWikiItem[] {
    const data: LibraryAiWikiItem[] = []

    this.items.getComponentList()
      .forEach((component) => {
        const aiWiki = new LibraryAiWikiItem(component)

        if (aiWiki.isAiWiki()) {
          data.push(aiWiki)
        }
      })

    return data
  }

  protected makeList(): void {
    const data = this.getList()
    const imports: string[] = []
    const list: string[] = []

    data.forEach((item) => {
      imports.push(item.getImport())
      list.push(`  ${item.getCode()}`)
    })

    this.items.write(
      this.getFileList(),
      [
        ...imports,
        '',
        'export const aiList: any[] = [',
        list.join(',\r\n'),
        ']'
      ],
      'wiki.ts'
    )
  }

  protected makeComponent() {
    PropertiesFile.writeByPath(
      [...UI_DIRS_COMPONENTS, 'AiWiki.vue'],
      `<script setup lang="ts">
// This file is generated by a script, do not edit.

import { DxtTestPage } from '@dxtmisha/test'
import { aiList } from '../library/${this.getFileList()}.wiki'

defineOptions({
  name: 'AiWiki'
})
</script>

<template>
  <DxtTestPage
    title="List of available UI components"
    description="Below is a list of Vue 3 components available in the UI. These components are available immediately and do not need to be imported."
  >
    <component
      v-for="(item, key) in aiList"
      :key="key"
      :is="item"
    />
  </DxtTestPage>
</template>
`
    )
  }
}
