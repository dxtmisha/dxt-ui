import{r as m,c as a,C as p,a0 as g,a1 as f,w as v,o as y,u as d,K as x,S as I,a2 as k,e as h,h as b,l as o,$ as w,z as B,A as L,B as M,D as S,E as A,F as E}from"./iframe-BlCC38XJ.js";import{_ as D}from"./D1ListItem-Crx23BEH.js";import{_ as C}from"./D1ListGroup-fFr1SCZU.js";import{_}from"./D1ListMenu-CSQAv5JA.js";import{a as G}from"./IconTrailingInclude-Dl0qqbyn.js";import{W as T}from"./WindowClassesInclude-CVb6KSq0.js";class F{constructor(e){this.props=e}item=m();timeout;highlight=a(()=>this.item.value??this.props.highlight);add(e){this.addChar(e).makeReset()}set(e){const t=this.getValue(e);this.item.value!==t&&(this.item.value=t)}reset(){return this.set(),this}getValue(e){if(p(e))return e.trim()}addChar(e){return this.item.value&&this.timeout?this.item.value+=e:this.item.value=e,this}makeReset(){return this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.timeout=void 0,2e3),this}}class N{constructor(e,t,s){this.props=e,this.element=t,this.listId=s}item=m();focus=a(()=>this.item.value?.index??this.props.focus);isElement(e){return!!this.getElement(e)}isItem(){return this.item.value?.type==="item"}isGroup(){return this.item.value?.type==="group"}isMenu(){return this.item.value?.type==="menu"}isOpen(){const e=this.getElement();return e&&(this.isGroup()||this.isMenu())?e.dataset.status==="open":!1}get(){return this.item.value}getSelector(e){return`[data-list-id="${this.listId}"][data-value="${e??this.item.value?.index}"]`}getElement(e){return document.querySelector(this.getSelector(e))??void 0}set(e){return this.item.value!==e&&(this.item.value=e),this}reset(){return this.set(void 0),this}click(){this.getElement()?.click()}toElementFocus(){if(this.item.value){const e=this.getElement();if(e)return this.toElement(e),!0}return!1}toElementSelected(e){return this.toElement(this.getElement(e)),this}toElement(e){const t="*[data-window-body]";e&&e.closest(t)&&g(t,e)}}class O{constructor(e,t,s,i){this.props=e,this.focus=t,this.data=s,this.emits=i}index=-1;set(e){return this.index!==e?(e<0?this.reset():this.setByIndex(e),this.focus.toElementFocus(),!0):!1}preparation(e){const t=this.data.map.value,s=t.findIndex(i=>f(i.index,e));this.reset(),s&&(this.index=s,t?.[s]&&this.focus.toElementSelected(t[s].index))}preparationBySelected(){this.props.selected&&requestAnimationFrame(()=>this.preparation(this.props.selected))}previous(){this.isFirstByParent()||(this.setByIndex(this.index-1),this.focus.toElementFocus()||this.previous())}next(){this.isLastByParent()||(this.setByIndex(this.index+1),this.focus.toElementFocus()||this.next())}reset(){this.index=-1,this.focus.reset()}open(){this.focus.isItem()?this.focus.click():(this.focus.isGroup()||this.focus.isMenu())&&(this.focus.click(),this.nextByType())}close(){const e=this.getMainItem();if(e){e.click();const t=this.data.getItemByIndex(e.dataset.value);t&&(this.set(t.key),this.focus.set(t.item))}else this.emits?.("close")}stop(){this.focus.reset()}isFirstByParent(){const e=this.focus.item.value?.parent;return e&&this.focus.isElement()?this.data.getFirstItemByParent(e)?.index===this.focus.item.value?.index:!1}isLastByParent(){const e=this.focus.item.value?.parent;return e&&this.focus.isElement()?this.data.getLastItemByParent(e)?.index===this.focus.item.value?.index:!1}getMainItem(){const e=this.focus.item.value?.parent;if(e&&!this.focus.isOpen())return this.focus.getElement(e)}setByIndex(e){const t=this.data.getLengthByMap();e>=t?this.index=0:e<0?this.index=t-1:this.index=e;const s=this.data.map.value[this.index];s&&(s.type==="item"||s.type==="group"||s.type==="menu")?this.focus.set(s):this.focus.reset()}nextByType(){this.setByIndex(this.index+1),!(this.focus.isItem()||this.focus.isGroup()||this.focus.isMenu())&&this.nextByType()}}class ${constructor(e,t,s,i){this.props=e,this.search=t,this.data=s,this.go=i,v(this.isActive,r=>{r?this.start():this.stop()},{immediate:!0}),y(()=>this.stop())}event;isActive=a(()=>!!this.props.control);isNotInput(e){return["INPUT","TEXTAREA"].indexOf(e.nodeName)===-1||!!this.getActiveElement()}getActiveElement(){if(d()){const e=document.activeElement;if(e&&e.dataset?.menuControl==="1")return e}}start(){d()&&(this.event||(this.event=new x(document.body,["keydown","keypress"],this.on)),this.go.reset(),this.event.start())}stop(){this.event&&(this.event.stop(),this.event=void 0,this.go.stop())}updateSearch(e){const t=this.getActiveElement();t?requestAnimationFrame(()=>this.search.set(t.value)):this.search.add(e.key)}on=e=>{if(this.isNotInput(e.target)&&this.data.getLength())if(e.type==="keypress")this.updateSearch(e);else switch(e.code||e.key||e.keyCode){case"Backspace":case 8:this.updateSearch(e);break;case"ArrowUp":case 38:e.preventDefault(),this.go.previous();break;case"ArrowDown":case 40:e.preventDefault(),this.go.next();break;case"Enter":case"ArrowRight":case" ":case 13:case 39:e.preventDefault(),this.go.open();break;case"ArrowLeft":case 37:e.preventDefault(),this.go.close();break;case"Space":case 32:this.getActiveElement()||(e.preventDefault(),this.go.open());break}}}let H=1;class R{constructor(e,t,s,i,r,c,l,u){this.props=e,this.refs=t,this.element=s,this.classDesign=i,this.className=r,this.components=c,this.slots=l,this.emits=u,this.search=new F(this.props),this.focus=new N(this.props,this.element,this.id),this.data=new I(k(this.props,"list"),this.focus.focus,this.search.highlight,this.refs.highlightLengthStart,this.refs.filterMode,this.refs.selected,this.refs.keyValue,this.refs.keyLabel,this.refs.liteThreshold,void 0,this.refs.max),this.go=new O(this.props,this.focus,this.data,this.emits),this.control=new $(this.props,this.search,this.data,this.go),this.event=new G(void 0,void 0,u),this.windowClasses=new T(i)}search;focus;data;event;go;control;windowClasses;id=++H;list=a(()=>this.props.lite?this.data.liteData.value:this.data.fullData.value);classes=a(()=>({[`${this.className}--highlightActive`]:!!this.props.filterMode&&this.data.isHighlight()}));itemBinds=a(()=>({tag:this.props.tag,divider:this.props.divider,onClick:this.event.onClick,...this.props.itemAttrs??{},listId:this.id}));isOpenGroup(e){const t=this.data.getSubList(e);return t.isSelected.value||t.isFocus()||t.isHighlight()}getItem(e){return h(this.itemBinds.value,e,{key:e.value,role:this.props.roleItem})}getItemGroup(e){return h(this.itemBinds.value,this.props.itemGroupAttrs,e,{key:e.value,class:`${this.className}__group`})}getItemMenu(e){return h(this.itemBinds.value,this.props.itemMenuAttrs,e,{key:e.value,class:`${this.className}__menu`})}getItemManagementFormGroup(e,t){return this.getItemManagement({...e,...t,filterMode:!1},t.open,this.props.iconArrowDown)}getItemManagementFormMenu(e,t){return this.getItemManagement({...e,filterMode:!1,isMenu:!0},t,this.props.iconArrowRight)}getList(e){return this.data.getSubList(e).fullData.value}getItemManagement(e,t,s){return h(this.itemBinds.value,this.props.itemManagementAttrs,e,{class:[`${this.className}__management`,this.windowClasses.get().static],focus:e?.index===this.focus.focus.value,selectedChild:this.isOpenGroup(e),open:t,iconTurn:t,iconTrailing:s,iconTrailingTurnOnly:!0,"data-status":t?"open":"close"})}}const V={keyLabel:"label",keyValue:"value",tag:"div",axis:"y"};class P extends b{item;constructor(e,t,s){super(e,t,s),this.item=new R(this.props,this.refs,this.element,this.getDesign(),this.getName(),this.components,this.slots,this.emits),this.init()}initExpose(){return{isSelected:this.item.data.isSelected,selectedList:this.item.data.selectedList,selectedNames:this.item.data.selectedNames,selectedValues:this.item.data.selectedValues}}initClasses(){return{main:this.item.classes.value,space:this.getSubClass("space"),line:this.getSubClass("line"),subtitle:this.getSubClass("subtitle"),html:this.getSubClass("html"),management:this.getSubClass("management"),group:this.getSubClass("group"),menu:this.getSubClass("menu"),menuGroup:this.getSubClass("menuGroup")}}initStyles(){return{}}initRender(){return o("div",{...this.getAttrs(),ref:this.element,class:this.classes?.value.main},this.renderData())}renderData=()=>this.renderDataByItem("item",this.item.list.value,!0);renderItem=(e,t)=>this.components.renderOne("listItem",this.getItemAttrs(e,t));renderItemGroup=(e,t)=>this.components.renderOne("listItem",this.item.getItemManagementFormGroup(e,t));renderItemMenu=(e,t)=>this.components.renderOne("listItem",h(this.item.getItemManagementFormMenu(e,!!t.open.value),t.binds));renderSpace=e=>o("div",{key:e.value,class:[this.classes?.value.space,this.item.windowClasses.get().static]});renderLine=e=>o("div",{key:e.value,class:[this.classes?.value.line,this.item.windowClasses.get().static]});renderSubtitle=e=>o("div",{key:e.value,class:[this.classes?.value.subtitle,this.item.windowClasses.get().static]},e.label);renderHtml=e=>{const t={key:e.label&&w(e.value)?e.label:e.value,class:[this.classes?.value.html,this.item.windowClasses.get().static]};return this.slots&&e.value in this.slots?o("div",t,this.initSlot(e.value)):o("div",{...t,innerHTML:e.label})};renderGroup=e=>this.components.renderOne("listGroup",{open:this.item.isOpenGroup(e),divider:this.props.divider,disabled:e.disabled},{head:t=>this.renderItemGroup(e,t),list:()=>this.renderDataByItem("group",this.item.getList(e))});renderMenu=(e,t)=>this.components.renderOne("listMenu",{divider:this.props.divider,axis:t&&this.props.axis==="x"?"y":"x",disabled:e.disabled},{head:s=>this.renderItemMenu(e,s),list:()=>this.renderDataByItem("menu",this.item.getList(e))});renderDataByItem(e,t,s=!1){const i=[];return t.forEach(r=>{switch(r.type){case"space":i.push(this.renderSpace(r));break;case"line":i.push(this.renderLine(r));break;case"subtitle":i.push(this.renderSubtitle(r));break;case"html":i.push(this.renderHtml(r));break;case"group":this.isHighlight(r)&&i.push(this.renderGroup(r));break;case"menu":this.isHighlight(r)&&i.push(this.renderMenu(r,s));break;default:i.push(this.renderItem(e,r));break}}),i.push(o("div")),i}isHighlight(e){return this.props.filterMode?this.item.data.getSubList(e).isHighlightActive():!0}getItemAttrs(e,t){switch(e){case"group":return this.item.getItemGroup(t);case"menu":return this.item.getItemMenu(t);default:return this.item.getItem(t)}}}const q=D,U=C,W=_,z={axis:["x","y"]},K={...V,iconArrowDown:"keyboard_arrow_down",iconArrowRight:"keyboard_arrow_right",axis:"y"},X=B({name:"D1List",__name:"D1List",props:L({focus:{type:[Number,String,Boolean]},selected:{type:[Number,String,Boolean,Array]},disabled:{type:Boolean},lite:{type:Boolean},list:{},liteThreshold:{},highlight:{},highlightLengthStart:{},filterMode:{type:Boolean},keyLabel:{},keyValue:{},max:{},tag:{},axis:{},divider:{type:Boolean},itemAttrs:{},itemManagementAttrs:{},itemGroupAttrs:{},itemMenuAttrs:{},iconArrowDown:{},iconArrowRight:{},roleItem:{},control:{type:Boolean}},K),emits:["click","clickLite","close"],setup(n,{expose:e,emit:t}){const s=t,i=n,r=a(()=>({main:{"d1-list":!0,[`d1-list--axis--${i.axis}`]:M(z.axis,i.axis),"d1-list--divider":i.divider}})),c=a(()=>({})),l=new P("d1.list",i,{emits:s,classes:r,styles:c,components:{listItem:q,listGroup:U,listMenu:W}}),u=l.render();return e(l.expose()),(j,J)=>(E(),S(A(u)))}});X.__docgenInfo={name:"D1List",exportName:"default",displayName:"D1List",description:"",tags:{},props:[{name:"divider",required:!1,type:{name:"boolean"}},{name:"axis",required:!1,type:{name:"union",elements:[{name:'"x"'},{name:'"y"'}]}}],sourceFiles:["/Volumes/T7/Code/dxt-ui/packages/d1/src/components/Ui/List/D1List.vue"]};export{X as _,K as d};
