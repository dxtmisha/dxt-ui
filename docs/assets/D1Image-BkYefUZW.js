import{u as w,a5 as A,Z as u,c as s,C as z,a6 as F,a7 as k,a8 as I,r as f,a9 as S,K as P,P as B,V as v,j as H,t as O,w as g,J as M,aa as W,o as C,h as _,l as c,z as D,A as R,B as E,D as L,E as N,F as G}from"./iframe-BlCC38XJ.js";import{A as p}from"./AriaStaticInclude-BOo8fnl5.js";const q=1280;class x{static isImage(t){return!!t.type.match(/^image\//)}static createImage(t){return new Promise(e=>{if(t){const i=new Image;i.onerror=()=>e(void 0),i.onload=()=>{e({image:i,src:this.getSRC(i,t),width:i.naturalWidth,height:i.naturalHeight})},(async()=>i.src=t instanceof File?await this.getFileResult(t):t)()}else e(void 0)})}static async getPath(t){return this.createImage(t).then(e=>e?.src??"")}static getFileResult(t){return new Promise(e=>{this.isImage(t)?this.getFileReader(t).then(i=>e(i)):e("")})}static getFileReader(t){return new Promise(e=>{const i=new FileReader;i.onload=()=>e(typeof i.result=="string"?i.result:""),i.readAsDataURL(t)})}static getSRC(t,e,i=q){return w()&&(e instanceof File||e===void 0)&&(t.naturalHeight>i||t.naturalWidth>i)?A(t,i)??"":t.src}}const y="#toolbar=0&scrollbar=1";class ${static isPdf(t){return u(t)?!!t.match(/\.pdf$/i):w()&&!!t.type.match(/\/pdf$/i)}static async get(t){return u(t)?`${t}${y}`:this.isPdf(t)?`${await x.getFileReader(t)}${y}`:""}}var r=(a=>(a.pdf="pdf",a.file="file",a.image="image",a.flag="flag",a.color="color",a.public="public",a.filled="filled",a.outlined="outlined",a.round="round",a.sharp="sharp",a.twoTone="two-tone",a.material="material",a.icon="icon",a))(r||{});class U{constructor(t){this.props=t}item=s(()=>{const t=this.props.value;if(t instanceof File||z(t)){if($.isPdf(t))return r.pdf;if(t instanceof File)return r.file;if(t.match(/\//))return r.image;if(t.match(F))return r.icon;if(t.match(/^#/))return r.color;if(t.match(/^@/))return r.public;if(t.match(/^\$/))return r.material;if(t.match(/^flag-[a-z]{2}$/))return r.flag;const e=t.match(/^(outlined|round|sharp|material)-/);return e?e[1]:k.is(t)?r.public:r.outlined}})}const K={adaptiveGroup:"basic",preloadOffset:"1024px"};class X{constructor(t,e){this.props=t,this.type=e,I(async()=>{this.image.value=await this.init()})}image=f();is(){return this.image.value!==void 0}isLink(){return this.is()&&typeof this.image.value=="string"}isImage(){return this.is()&&typeof this.image.value!="string"}async init(){const t=this.props.value;if(t)switch(this.type.item.value){case r.pdf:return await $.get(t);case r.image:case r.file:try{return this.props.lazy?this.props.value:await x.createImage(t)}catch{console.error("ImageData.initImage: ",t)}break;case r.public:case r.icon:case r.flag:if(u(t))return await k.get(t,this.props.url);break}}}class Y{constructor(t){this.props=t}coordinator=s(()=>{if(this.is()){const t=this.props.coordinator;switch(t.length){case 1:return[t[0]??0,t[0]??0,t[0]??0,t[0]??0];case 2:return[t[0]??0,t[1]??0,t[0]??0,t[1]??0];case 3:return[t[0]??0,t[1]??0,t[2]??0,t[1]??0];case 4:return t}}return[0,0,0,0]});size=s(()=>{const t=this.coordinator.value;return{width:100-t[1]-t[3],height:100-t[2]-t[0]}});is(){const t=this.props.coordinator;return S(t)&&t.length>0&&t.length<5}getSize(){const t=this.size.value,e=t.width===0?100:t.width,i=t.height===0?100:t.height;return{width:`${100/e*100}%`,height:`${100/i*100}%`}}}class Z{constructor(t,e){this.props=t,this.coordinator=e}x=s(()=>this.coordinator.is()?`${this.coordinator.coordinator.value[3]+this.coordinator.size.value.width/2}%`:this.props.x?.toString()||"center");y=s(()=>this.coordinator.is()?`${this.coordinator.coordinator.value[0]+this.coordinator.size.value.height/2}%`:this.props.y?.toString()||"center")}class J{constructor(t){this.name=t}factorMax=1;size={width:0,height:0};offset={width:7680,height:7680};is(t){return this.name===t}isSize(){return!!(this.size.width||this.size.width)}getWidth(){return this.size.width}getHeight(){return this.size.height}getOffsetWidth(){return this.offset.width}getOffsetHeight(){return this.offset.height}getFactorMax(){return this.factorMax}makeWidth(t){return t>this.size.width&&(this.size.width=t),this}makeHeight(t){return t>this.size.height&&(this.size.height=t),this}makeOffsetWidth(t){return t<this.offset.width&&(this.offset.width=t),this}makeOffsetHeight(t){return t<this.offset.height&&(this.offset.height=t),this}makeFactorMax(t){return t<this.factorMax&&(this.factorMax=t),this}reset(){return this.factorMax=1,this.size={width:0,height:0},this.offset={width:7680,height:7680},this}}class h{static items=[];static isSize(){return this.items.find(t=>t.isSize())!==void 0}static get(t){return this.find(t)||this.init(t)}static reset(){this.items.forEach(t=>t.reset())}static find(t){return this.items.find(e=>e.is(t))}static init(t){const e=new J(t);return this.items.push(e),e}}class m{static objects=[];static objectsAdaptive=[];static cache=[];static event;static time;static is(t){return this.objects.findIndex(e=>e===t)!==-1}static add(t){this.is(t)||(this.objects.push(t),this.make())}static remove(t){const e=this.objects.findIndex(i=>i===t);e!==-1&&(this.objects.splice(e,1),this.cache=[]),this.make()}static reset(){this.cache=[],this.start()}static make(){this.event&&this.objects.length<1?(this.event.stop(),this.event=void 0):this.objects.length>0&&(this.event||(this.event=new P(window,["scroll-sync"],()=>this.start()).start()),this.time||(this.time=!0,requestAnimationFrame(()=>{this.time=!1,this.start()})))}static getItemIdByVisible(){return B(this.objectsAdaptive,t=>t.getId())}static start(){if(this.isAdaptive()){this.makeAdaptive();const t=this.getItemIdByVisible();this.isCache(t)&&(this.cache=t,this.makeSize(),this.makePercent(),this.makeFactorMax())}else this.event?.stop()}static makeAdaptive(){this.objectsAdaptive=[],this.objects.forEach(t=>{t.make(),t.isBeyond()&&this.objectsAdaptive.push(t)})}static makeSize(){h.reset(),this.objectsAdaptive.forEach(t=>{const e=t.element.value;e&&h.get(t.group.value).makeWidth(t.width.value).makeHeight(t.height.value).makeOffsetWidth(e.offsetWidth).makeOffsetHeight(e.offsetHeight)})}static makePercent(){h.isSize()&&this.objectsAdaptive.forEach(t=>{const e=t.element.value,i=h.get(t.group.value);if(e){const n=i.getWidth(),o=i.getHeight();t.setPercent(t.width.value*(n?1/n:0)*(i.getOffsetWidth()/e.offsetWidth),t.height.value*(o?1/o:0)*(i.getOffsetHeight()/e.offsetHeight))}})}static makeFactorMax(){h.isSize()&&this.objectsAdaptive.forEach(t=>{h.get(t.group.value).makeFactorMax(t.factor.value)})}static isAdaptive(){return!!this.objects.find(t=>t.is())}static isCache(t){return this.cache.join("|")!==t.join("|")}}const Q="main",b=512;class T{constructor(t,e,i){this.props=t,this.data=e,this.element=i,I(()=>{this.is()?m.add(this):m.remove(this)})}percent=f({width:0,height:0});beyond=!1;visible=!1;active=s(()=>!!(this.props.adaptive&&(this.width.value||this.height.value))&&this.data.isImage());group=s(()=>this.props.adaptiveGroup??Q);width=s(()=>v(this.props.objectWidth??0));height=s(()=>v(this.props?.objectHeight??0));type=s(()=>{if(this.width.value&&this.percent.value.width>0)return"x";if(this.height.value&&this.percent.value.height>0)return"y"});size=s(()=>{if(this.element.value&&this.data.isImage()){const t=this.data.image.value;switch(this.type.value){case"x":return t.height*(this.element.value.offsetWidth*this.percent.value.width/t.width);case"y":return t.width*(this.element.value.offsetHeight*this.percent.value.height/t.height)}}return 0});factor=s(()=>{const t=this.element.value;if(t){const e=this.size.value;if(this.type.value==="x"&&e>t.offsetHeight)return t.offsetHeight/e;if(this.type.value==="y"&&e>t.offsetWidth)return t.offsetWidth/e}return 1});is(){return this.active.value&&!!this.element.value?.closest("body")}isGroup(t){return this.group.value===t}isBeyond(){return this.beyond}isVisible(){return this.visible}getId(){return H(this.element.value)}getBackgroundSize(){const t=h.get(this.group.value).getFactorMax();switch(this.type.value){case"x":return`${100*this.percent.value.width*t}% auto`;case"y":return`auto ${100*this.percent.value.height*t}%`}return null}setPercent(t,e){return(this.percent.value.width!==t||this.percent.value.height!==e)&&(this.percent.value={width:t,height:e}),this}remove(){this.active.value&&m.remove(this)}make(){if(this.beyond=!1,this.visible=!1,this.element.value&&this.is())if(this.props.adaptiveAlways)this.beyond=!0,this.visible=!0;else{const t=this.element.value.getBoundingClientRect();this.beyond=!(t.bottom<0-b||t.top>window.innerHeight+b),this.visible=!(t.bottom<0||t.top>window.innerHeight)}return this}}class V{constructor(t,e,i,n){this.props=t,this.data=e,this.coordinator=i,this.adaptive=n}image=s(()=>{const t=this.imageSrc.value;return t?`url("${t}")`:null});imageSrc=s(()=>{const t=this.data.image.value;switch(typeof t){case"string":return t;case"object":return t.src;default:return null}});size=s(()=>{if(this.coordinator.is())return this.getSizeByCoordinator();if(this.adaptive.is()){const t=this.adaptive.getBackgroundSize();if(t)return t}return this.getSizeForItem()});isImage(){return!!this.image.value}getSize(t,e){const i=this.data.image.value;return typeof i=="object"?i.height<i.width?`auto ${e}`:`${t} auto`:null}getSizeByCoordinator(){const{width:t,height:e}=this.coordinator.getSize();return this.getSize(t,e)}getSizeForItem(){const t=this.props.size;return z(t)?t.toString().match(/%$/)?this.getSize(t,t):t.toString():null}}class tt{constructor(t,e,i,n,o){this.props=t,this.element=e,this.type=i,this.position=n,this.background=o;const{lazy:d,preloadOffset:l}=O(t);g([d,l,e],()=>{this.props.lazy&&this.element.value?this.makeLazy():(this.lazyInit.value=!1,this.lazyStatus?.stop(),this.lazyStatus=void 0)},{immediate:!0})}lazyInit=f(!1);lazyStatus;is=s(()=>!!this.props.tagImg&&this.isType());isLazy=s(()=>!!this.props.lazy&&!this.lazyInit.value);isPicture=s(()=>this.is.value&&!!this.props.picture);binds=s(()=>{const t={key:"img"};return this.is.value&&(t.src=this.background.imageSrc.value,t.alt=this.props.alt??"",t.width="100%",t.height="100%",t.style=this.styles.value,this.props.lazy&&(t.loading=this.isLazy.value?"lazy":"auto"),this.props.srcset&&(t.srcset=this.getSrcset())),t});picture=s(()=>{if(this.props.picture)return S(this.props.picture)?this.props.picture:B(this.props.picture,(t,e)=>({key:e,srcset:t,media:`(width >= ${e})`}))});styles=s(()=>{const t={"object-position":`${this.position.x.value} ${this.position.y.value}`,"--sys-transform-originX":this.position.x.value,"--sys-transform-originY":this.position.y.value};return this.isSize()&&(t["--sys-transform-scale"]=this.getSize()),t});isType(){const t=this.type.item.value;return t===r.file||t===r.image}isSize(){const t=this.background.size.value;return!!(t&&t.match("[% ]"))}getSize(){return this.background.size.value?.replace("auto","")?.trim()}getSrcset(){if(this.props.srcset)return typeof this.props.srcset=="string"?this.props.srcset:Object.entries(this.props.srcset).map(([t,e])=>`${e} ${this.toSrcsetKey(t)}`).join(", ")}toSrcsetKey(t){return M(t)?`${t}w`:String(t)}makeLazy(){const t=W(this.element,`${this.props.preloadOffset} 0px`).lazyItemStatus;this.lazyStatus=g(t,()=>{this.lazyInit.value=t.value},{immediate:!0})}}let et=class{constructor(t,e,i,n){this.props=t,this.element=e,this.className=i,this.emits=n,this.type=new U(t),this.data=new X(t,this.type),this.coordinator=new Y(t),this.position=new Z(t,this.coordinator),this.adaptiveItem=new T(t,this.data,e),this.background=new V(t,this.data,this.coordinator,this.adaptiveItem),this.img=new tt(this.props,e,this.type,this.position,this.background),n&&g(this.data.image,o=>{n("load",{type:this.type.item.value,image:o})}),C(()=>this.adaptiveItem.remove())}type;data;coordinator;position;adaptiveItem;background;img;tag=s(()=>this.img.is.value?"img":"span");text=s(()=>{const t=this.type.item.value;if(t===r.pdf){const i=this.data.image.value;if(u(i))return i}const e=this.props.value;if(t&&u(e)&&["filled","outlined","round","sharp","two-tone","material"].indexOf(t)!==-1)return e.replace(/^(filled|outlined|round|sharp|two-tone)-/,"")});classes=s(()=>{const t=this.type.item.value,e={[`${this.className}--type--${t}`]:t!==void 0,[`${this.className}--background`]:this.background.isImage(),notranslate:!0};switch(this.img.is.value&&(e[`${this.className}--img`]=!0),t){case"outlined":e["material-symbols-outlined"]=!0;break;case"round":e["material-symbols-rounded"]=!0;break;case"sharp":e["material-symbols-sharp"]=!0;break;case"material":e["material-icons"]=!0;break}return e});styles=s(()=>{const t=this.props.value;if(t)switch(this.type.item.value){case r.file:case r.image:return{"background-image":this.background.image.value,"background-size":this.background.size.value,"background-position-x":this.position.x.value,"background-position-y":this.position.y.value};case r.icon:return{"background-image":this.background.image.value};case r.flag:return{"background-image":this.background.image.value,"background-size":"contain"};case r.public:return{"mask-image":this.background.image.value};case r.color:if(u(t))return{"background-color":t}}return{}});binds=s(()=>({translate:"no",...p.role("img"),...p.label(this.props.alt),...p.hidden()}));valueBinds=s(()=>({key:"value",data:this.data.image.value}))};class it extends _{item;constructor(t,e,i){super(t,e,i),this.item=new et(this.props,this.element,this.getName(),this.emits),this.init()}initExpose(){return{type:this.item.type.item,data:this.item.data.image}}initClasses(){return{main:this.item.classes.value}}initStyles(){return this.item.styles.value}initRender(){return this.item.img.isPicture.value?this.renderPicture():this.item.img.is.value?this.renderImg():c("span",this.propsMain.value,this.renderValue())}propsImage=s(()=>({...this.getAttrs(),ref:this.element,key:"image",class:this.classes?.value.main}));propsMain=s(()=>({...this.propsImage.value,...this.item.binds.value,style:this.styles?.value}));renderPicture=()=>{const t=this.item.img.picture.value,e=[];return t&&t.forEach(i=>{e.push(c("source",i))}),e.push(this.renderImgItem()),c("picture",this.propsImage.value,e)};renderImg=()=>c("span",this.propsImage.value,this.renderImgItem());renderImgItem=()=>c("img",this.item.img.binds.value);renderValue=()=>this.item.type.item.value===r.pdf?c("object",this.item.valueBinds.value):this.item.text.value}const st={size:["auto","contain","cover"]},at={...K},rt=D({name:"D1Image",__name:"D1Image",props:R({value:{},url:{},adaptiveGroup:{},adaptiveAlways:{type:Boolean},objectWidth:{},objectHeight:{},coordinator:{},x:{},y:{},tagImg:{type:Boolean},srcset:{},picture:{},alt:{},lazy:{type:Boolean},preloadOffset:{},fetchPriority:{},turn:{type:Boolean},disabled:{type:Boolean},hide:{type:Boolean},adaptive:{type:Boolean},size:{}},at),emits:["load"],setup(a,{expose:t,emit:e}){const i=e,n=a,o=s(()=>({main:{"d1-image":!0,"d1-image--turn":n.turn,"d1-image--disabled":n.disabled,"d1-image--hide":n.hide,"d1-image--adaptive":n.adaptive,[`d1-image--size--${n.size}`]:E(st.size,n.size)}})),d=s(()=>({})),l=new it("d1.image",n,{emits:i,classes:o,styles:d}),j=l.render();return t(l.expose()),(nt,ot)=>(G(),L(N(j)))}});rt.__docgenInfo={name:"D1Image",exportName:"default",displayName:"D1Image",description:"",tags:{},props:[{name:"size",required:!1,type:{name:"union",elements:[{name:'"auto"'},{name:'"contain"'},{name:'"cover"'}]}},{name:"adaptive",required:!1,type:{name:"boolean"}},{name:"hide",required:!1,type:{name:"boolean"}},{name:"disabled",required:!1,type:{name:"boolean"}},{name:"turn",required:!1,type:{name:"boolean"}}],sourceFiles:["/Volumes/T7/Code/dxt-ui/packages/d1/src/components/Ui/Image/D1Image.vue"]};export{rt as _,at as d};
